# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# ğŸš€ GITHUB ACTIONS - DÃ©ploiement Continu (CD)
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
#
# ğŸ¯ OBJECTIF PÃ‰DAGOGIQUE
# Pipeline CI/CD automatisant le dÃ©ploiement sur VPS Ã  chaque push sur main.
# Illustre les concepts de dÃ©ploiement continu, gestion de secrets, et SSH automation.
#
# ğŸ“š CONCEPTS CLÃ‰S
# - CI/CD : Continuous Integration / Continuous Deployment
# - Infrastructure as Code : dÃ©ploiement reproductible et versionnÃ©
# - Secrets management : credentials sÃ©curisÃ©s (pas en clair dans le code)
# - SSH automation : commandes distantes sÃ©curisÃ©es
# - Idempotence : script rÃ©exÃ©cutable sans effets de bord
#
# ğŸ”— WORKFLOW
# 1. Push sur main â†’ dÃ©clenche automatiquement
# 2. GitHub Actions clone le code
# 3. Connexion SSH au VPS
# 4. Pull/clone du repo sur le VPS
# 5. Rebuild des containers Docker
# 6. RedÃ©marrage de la stack MLOps
#
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

name: Deploy to VPS

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# ğŸ¬ DÃ‰CLENCHEURS (Triggers)
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
on:
  push:
    branches:
      - main
    # âœ… DÃ©clenche Ã  chaque push sur main (stratÃ©gie trunk-based development)
    # Alternative : dÃ©ployer uniquement sur tags (ex: v1.0.0) pour plus de contrÃ´le
    
  workflow_dispatch:
    # ğŸ–±ï¸ Permet dÃ©clenchement manuel depuis l'UI GitHub
    # Utile pour : redÃ©ploiement aprÃ¨s incident, rollback, tests
    # Accessible : onglet Actions â†’ Select workflow â†’ Run workflow

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# ğŸ’¼ JOB DE DÃ‰PLOIEMENT
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
jobs:
  deploy:
    runs-on: ubuntu-latest
    # ğŸ–¥ï¸ Runner GitHub-hosted (machine virtuelle Ubuntu)
    # Alternatives : self-hosted runner (sur le VPS lui-mÃªme, Ã©conomise SSH)
    
    steps:
      # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      # Ã‰TAPE 1 : RÃ©cupÃ©ration du code
      # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      - name: ğŸ“¥ Checkout code
        uses: actions/checkout@v4
        # ğŸ“¦ Action officielle GitHub : clone le repo dans le runner
        # Ã‰quivalent Ã  : git clone https://github.com/{owner}/{repo}.git
        # @v4 : version de l'action (pinning pour stabilitÃ©)
        #
        # ğŸ’¡ POURQUOI CHECKOUT ?
        # MÃªme si on re-clone sur le VPS, utile pour :
        # - Futurs steps de tests (pytest, linting)
        # - Build d'images Docker en local avant push registry

      # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      # Ã‰TAPE 2 : Configuration SSH
      # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      - name: ğŸ” Setup SSH
        run: |
          mkdir -p ~/.ssh
          # ğŸ“ CrÃ©e rÃ©pertoire SSH (non existant par dÃ©faut sur runner)
          
          echo "${{ secrets.SSH_PRIVATE_KEY }}" > ~/.ssh/id_ed25519
          # ğŸ”‘ Ã‰crit la clÃ© privÃ©e depuis GitHub Secrets
          # Format attendu : clÃ© ED25519 (plus sÃ©curisÃ©e que RSA)
          # GÃ©nÃ©ration : ssh-keygen -t ed25519 -C "github-actions"
          
          chmod 600 ~/.ssh/id_ed25519
          # ğŸ”’ Permissions strictes (lecture seule pour owner)
          # SSH refuse de fonctionner si permissions trop permissives
          
          ssh-keyscan -H ${{ secrets.VPS_HOST }} >> ~/.ssh/known_hosts
          # ğŸ›¡ï¸ Ajoute la clÃ© publique du serveur (Ã©vite prompt "Are you sure?")
          # -H : hash du hostname (sÃ©curitÃ© supplÃ©mentaire)
          # Alternative : ajouter manuellement la fingerprint du serveur
        
        # ğŸ” SÃ‰CURITÃ‰ : SECRETS GITHUB
        # Configuration : Settings â†’ Secrets and variables â†’ Actions
        # Secrets requis :
        #   - SSH_PRIVATE_KEY : clÃ© privÃ©e ED25519 (publique sur VPS)
        #   - VPS_HOST : IP ou domaine (ex: 51.178.42.69 ou app.monvps.com)
        #   - VPS_USER : utilisateur SSH (ex: ubuntu, debian, deploy)
        #   - GH_TOKEN : Personal Access Token pour clone privÃ© (si repo privÃ©)

      # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      # Ã‰TAPE 3 : DÃ©ploiement sur le VPS
      # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      - name: ğŸ“¦ Deploy to VPS
        env:
          # ğŸŒ Variables d'environnement disponibles dans le script SSH
          VPS_HOST: ${{ secrets.VPS_HOST }}
          VPS_USER: ${{ secrets.VPS_USER }}
          GH_TOKEN: ${{ secrets.GH_TOKEN }}
          STUDENT_ID: ${{ secrets.STUDENT_ID }}
          REPO_NAME: ${{ github.repository }}  # Format: owner/repo
        
        run: |
          ssh $VPS_USER@$VPS_HOST << 'ENDSSH'
          # ğŸ“¡ CONNEXION SSH avec heredoc (commandes multi-lignes)
          # 'ENDSSH' avec quotes â†’ pas d'expansion de variables locales
          # Variables GitHub accessibles via interpolation avant SSH

            # Variables
            STUDENT_ID="${{ secrets.STUDENT_ID }}"
            PROJECT_DIR="~/apps/computer-vision-cats-and-dogs-v3-${STUDENT_ID}"

            # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
            # ğŸ“‚ NAVIGATION ET GESTION DU REPOSITORY
            # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•           
            if [ -d "$PROJECT_DIR" ]; then
              # â™»ï¸ MISE Ã€ JOUR : repo existe dÃ©jÃ 
              cd $PROJECT_DIR
              git pull
              # ğŸ’¡ Rapide : tÃ©lÃ©charge uniquement les nouveaux commits
              # PrÃ©suppose : branche main trackÃ©e, pas de conflits locaux
            else
              # ğŸ†• PREMIÃˆRE INSTALLATION : clone complet
              cd ~/apps
              # ğŸ“ RÃ©pertoire de dÃ©ploiement (Ã  crÃ©er manuellement au setup VPS)
              git clone https://${{ secrets.GH_TOKEN }}@github.com/${{ github.repository }}.git computer-vision-cats-and-dogs-v3-${STUDENT_ID}
              # ğŸ” Clone avec token (requis si repo privÃ©)
              # Token scope nÃ©cessaire : repo (full control)
              cd computer-vision-cats-and-dogs-v3-${STUDENT_ID}
            fi
            
            # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
            # ğŸ” GESTION DU FICHIER .env (SECRETS DE PRODUCTION)
            # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
            # Copier le .env spÃ©cifique Ã  l'Ã©tudiant
            cp ~/apps/.env.${STUDENT_ID} .env
            cp ~/apps/.env.${STUDENT_ID} docker/.env
            # ğŸ“‹ Copie .env depuis emplacement sÃ©curisÃ© (hors repo Git)
            # ~/apps/.env crÃ©Ã© manuellement au setup VPS avec :
            #   DB_PWD=...
            #   API_TOKEN=...
            #   GRAFANA_ADMIN_PASSWORD=...
            #   DISCORD_WEBHOOK_URL=...
            #
            # ğŸ’¡ POURQUOI 2 COPIES ?
            # - .env : racine (pour scripts Python locaux si besoin)
            # - docker/.env : lu par docker-compose.yml (env_file: ../.env)
            #
            # âš ï¸ ALTERNATIVE (non recommandÃ©e en prod) :
            # Passer secrets via GitHub Secrets + substitution dans docker-compose
            # â†’ Risque : secrets visibles dans docker inspect
            
            # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
            # ğŸ³ DÃ‰PLOIEMENT DOCKER
            # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
            cd docker
            # ğŸ“‚ Sous-rÃ©pertoire contenant docker-compose.yml et Dockerfile.app
            
            docker compose -p cv-${STUDENT_ID} down 2>/dev/null || true
            # ğŸ›‘ ARRÃŠT GRACIEUX des containers existants
            # 2>/dev/null : supprime erreurs si pas de containers (premiÃ¨re install)
            # || true : ne fait pas Ã©chouer le script si erreur (idempotence)
            #
            # ğŸ’¡ down vs stop :
            # - stop : arrÃªte containers (gardÃ©s pour restart rapide)
            # - down : arrÃªte + supprime containers + rÃ©seau (clean slate)
            
            docker compose -p cv-${STUDENT_ID} build --no-cache
            # ğŸ”¨ REBUILD des images Docker
            # --no-cache : force rebuild complet (ignore layers en cache)
            # 
            # âš ï¸ COMPROMIS PERFORMANCE vs FRAÃCHEUR
            # --no-cache :
            #   âœ… Garantit derniÃ¨res dÃ©pendances (pip, apt)
            #   âŒ Lent (~5 min avec TensorFlow)
            # Sans --no-cache :
            #   âœ… Rapide (rÃ©utilise layers)
            #   âŒ Peut manquer updates critiques (ex: security patch)
            #
            # Alternative optimisÃ©e : build seulement si Dockerfile/requirements changÃ©s
            
            docker compose -p cv-${STUDENT_ID}
            # ğŸš€ DÃ‰MARRAGE des containers en mode dÃ©tachÃ©
            # -d : background (daemon mode)
            # Ordre de dÃ©marrage : cf. depends_on dans docker-compose.yml
            #   1. postgres (healthcheck)
            #   2. cv_app (attend postgres healthy)
            #   3. prometheus
            #   4. grafana
            
            # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
            # ğŸ§¹ NETTOYAGE (Ã©viter saturation disque)
            # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
            docker image prune -af --filter "until=24h"
            # ğŸ—‘ï¸ SUPPRESSION des images non utilisÃ©es (dangling)
            # -a : toutes images inutilisÃ©es (pas que dangling)
            # -f : force (pas de confirmation)
            # --filter "until=24h" : garde images rÃ©centes (rollback rapide)
            #
            # ğŸ’¾ GAIN D'ESPACE TYPIQUE
            # AprÃ¨s quelques dÃ©ploiements : ~2-5 GB rÃ©cupÃ©rÃ©s
            # Image cv_app : ~800MB (Python + TensorFlow)
            
            # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
            # ğŸ“Š VÃ‰RIFICATION DU DÃ‰PLOIEMENT
            # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
            echo "âœ… Containers pour ${STUDENT_ID} :"
            docker compose -p cv-${STUDENT_ID} ps
            # ğŸ“‹ Affiche statut de chaque service
            # Colonnes : NAME | STATUS | PORTS | HEALTH
            # âš ï¸ VÃ©rifier :
            # - STATUS = Up (pas Restarting ou Exited)
            # - HEALTH = healthy (si healthcheck configurÃ©)
          ENDSSH
          # ğŸ FIN du bloc SSH

      # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      # Ã‰TAPE 4 : Confirmation du dÃ©ploiement
      # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      - name: âœ… Deployment Success
        run: |
          echo "ğŸ‰ DÃ©ploiement rÃ©ussi pour ${{ secrets.STUDENT_ID }}"
          echo "ğŸ“Š Grafana: http://${{ secrets.VPS_HOST }}:${{ secrets.STUDENT_PORT_GRAFANA }}"
          echo "ğŸ”§ API: http://${{ secrets.VPS_HOST }}:${{ secrets.STUDENT_PORT_API }}"
          echo "ğŸ“ˆ Prometheus: http://${{ secrets.VPS_HOST }}:${{ secrets.STUDENT_PORT_PROMETHEUS }}"
        # ğŸ“ Affiche dans les logs GitHub Actions (onglet Summary)
        # Utile pour : accÃ¨s rapide aux services, debugging URLs

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# ğŸ“ AMÃ‰LIORATIONS POSSIBLES (pour aller plus loin)
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
#
# 1. TESTS AVANT DÃ‰PLOIEMENT
#    - name: ğŸ§ª Run tests
#      run: |
#        pip install -r requirements/dev.txt
#        pytest tests/ -v
#    â†’ Ã‰vite dÃ©ploiement si tests Ã©chouent
#
# 2. SMOKE TESTS POST-DÃ‰PLOIEMENT
#    - name: ğŸ”¥ Health check
#      run: |
#        curl -f http://${{ secrets.VPS_HOST }}:8000/health || exit 1
#    â†’ VÃ©rifie que l'API rÃ©pond (rollback auto si Ã©chec)
#
# 3. NOTIFICATIONS (Discord, Slack)
#    - name: ğŸ“¢ Notify deployment
#      if: success()
#      run: |
#        curl -X POST ${{ secrets.DISCORD_WEBHOOK }} \
#          -H "Content-Type: application/json" \
#          -d '{"content":"âœ… DÃ©ploiement V3 rÃ©ussi !"}'
#
# 4. ROLLBACK AUTOMATIQUE
#    - Sauvegarder hash du commit avant pull
#    - Si healthcheck Ã©choue â†’ git reset --hard $PREVIOUS_HASH
#
# 5. STAGING ENVIRONMENT
#    - DÃ©ployer d'abord sur staging (branches develop)
#    - Validation manuelle â†’ merge main â†’ dÃ©ploiement prod
#
# 6. DOCKER REGISTRY (optimisation)
#    - Build image en CI â†’ push vers DockerHub/GHCR
#    - VPS pull image (pas de rebuild sur serveur)
#    â†’ DÃ©ploiement 10x plus rapide
#
# 7. SECRETS ROTATION
#    - Automatiser rotation des credentials (DB, API tokens)
#    - Utiliser HashiCorp Vault ou AWS Secrets Manager
#
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# ğŸ› ï¸ SETUP INITIAL DU VPS (Ã  faire manuellement UNE FOIS)
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
#
# 1. INSTALLATION DOCKER
#    curl -fsSL https://get.docker.com | sh
#    sudo usermod -aG docker $USER
#
# 2. CRÃ‰ATION STRUCTURE
#    mkdir -p ~/apps
#    cd ~/apps
#    nano .env  # Remplir avec secrets production
#
# 3. CONFIGURATION SSH
#    # Sur VPS
#    ssh-keygen -t ed25519
#    cat ~/.ssh/id_ed25519.pub >> ~/.ssh/authorized_keys
#    
#    # Copier ~/.ssh/id_ed25519 dans GitHub Secrets (SSH_PRIVATE_KEY)
#
# 4. FIREWALL (ufw)
#    sudo ufw allow 22    # SSH
#    sudo ufw allow 8000  # FastAPI
#    sudo ufw allow 3000  # Grafana
#    sudo ufw allow 9090  # Prometheus
#    sudo ufw enable
#
# 5. REVERSE PROXY (optionnel, recommandÃ©)
#    # Nginx avec SSL (Let's Encrypt)
#    # api.mondomaine.com â†’ localhost:8000
#    # grafana.mondomaine.com â†’ localhost:3000
#
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# ğŸ“š RESSOURCES PÃ‰DAGOGIQUES
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
#
# - GitHub Actions docs: https://docs.github.com/en/actions
# - Docker Compose in prod: https://docs.docker.com/compose/production/
# - SSH best practices: https://www.ssh.com/academy/ssh/key
# - CI/CD patterns: https://www.martinfowler.com/articles/continuousIntegration.html
#
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•